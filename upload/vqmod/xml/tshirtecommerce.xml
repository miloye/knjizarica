<modification>
	<id>tshirtecommerce</id>
	<version>4.1.0</version>
	<vqmver>2.6.1</vqmver>
	<author>Tshirtecommerce Team</author>
	
	<!-- BEFIN SYSTEM -->
	<file name="system/library/cart.php">
		<operation error="skip">
			<search position="after"><![CDATA[$option_data = array();]]></search>
			<add><![CDATA[
				$temp_options = json_decode($cart['option'], TRUE);

				if (isset($temp_options['design'])) $design = $temp_options['design'];
				else $design = FALSE;
			]]></add>
		</operation>
		<operation error="skip">
			<search position="before"><![CDATA[$product_data[] = array(]]></search>
			<add><![CDATA[
				if ($design !== FALSE)
				{
					if(isset($design['price'])) $option_price += $design['price'];
					if(isset($design['oc_price_of_print']))
					{
						$option_price += $design['oc_price_of_print'];
					}
					// price with [attributes]
					$price_attributes = 0;
					$e_design = new \stdClass();
					$e_attributes = new \stdClass();
					$file = dirname(DIR_SYSTEM) . '/tshirtecommerce/data/products.json';
					if (file_exists($file))
					{
						$string = file_get_contents($file);
						if ($string != false)
						{
							$e_products = json_decode($string);
							if ( isset($e_products->products) && count($e_products->products) > 0 && isset($design['design_product_id']))
							{
								foreach($e_products->products as $values)
								{
									if($values->id == $design['design_product_id'])
									{
										$e_design = $values->design;
										$e_attributes = $values->attributes;
										break;
									}
								}
							}
						}
					}
					if(isset($e_attributes) && isset($e_attributes->type))
					{
						foreach($e_attributes->type as $type_idx => $type_val)
						{
							foreach($design['options'] as $curr_val)
							{
								if($type_val == $curr_val['type'] && isset($curr_val['value']))
								{
									switch($curr_val['type'])
									{
										case 'textlist':
											foreach($curr_val['value'] as $tlkey => $tlval)
											{
												if($tlval > 0)
												{
													foreach($e_attributes->titles[$type_idx] as $idx => $val)
													{
														if($tlkey == $val && isset($e_attributes->prices[$type_idx]) && isset($e_attributes->prices[$type_idx][$idx])) 
															$price_attributes += $e_attributes->prices[$type_idx][$idx] * $tlval / $cart['quantity'];
													}
												}
											}
											break;
										case 'checkbox':
											foreach($curr_val['value'] as $tlval)
											{
												if(!empty($tlval))
												{
													foreach($e_attributes->titles[$type_idx] as $idx => $val)
													{
														if($tlval == $val && isset($e_attributes->prices[$type_idx]) && isset($e_attributes->prices[$type_idx][$idx])) 
															$price_attributes += $e_attributes->prices[$type_idx][$idx];
													}
												}
											}
											break;
										case 'selectbox':
										case 'radio':
											if(!empty($curr_val['value']))
											{
												foreach($e_attributes->titles[$type_idx] as $idx => $val)
												{
													if($curr_val['value'] == $val && isset($e_attributes->prices[$type_idx]) && isset($e_attributes->prices[$type_idx][$idx])) 
														$price_attributes += $e_attributes->prices[$type_idx][$idx];
												}
											}
											break;
										default:
											break;
									}
								}
							}
						}
					}
					$option_price += $price_attributes;
					// price with [product design > price]
					if(isset($design['color_hex']) && isset($e_design) && isset($e_design->color_hex) && isset($e_design->price))
					{
						foreach($e_design->color_hex as $idx=>$color_hex)
						{
							if($color_hex == $design['color_hex'])
							{
								$option_price += (isset($e_design->price[$idx]) ? $e_design->price[$idx] : 0);
								break;
							}
						}
					}
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[$reward * $cart['quantity'],]]></search>
			<add><![CDATA[
				'design' => $design,
			]]></add>
		</operation>		
	</file>
	<!-- END SYSTEM -->

	<!-- BEGIN ADMIN -->
	<file name="admin/controller/common/logout.php">
		<operation error="skip">
			<search position="after"><![CDATA[$this->user->logout();]]></search>
			<add><![CDATA[
				$sess_file = str_replace('system', '', DIR_SYSTEM).'/tshirtecommerce/admin/tmp/session_'.session_id();
				if(file_exists($sess_file))
				{
					unlink($sess_file);
				}
				unset($this->session->data['is_admin']);
				unset($_SESSION['is_admin']);
			]]></add>
		</operation>
	</file>
	<file name="admin/controller/common/menu.php">
		<operation error="skip">
			<search position="before"><![CDATA[$data['installer']]]></search>
			<add><![CDATA[
				$data['tshirtecommerce_show_menu'] 	= $this->config->get('tshirtecommerce_menu');;
				$data['designer_build'] 			= $this->url->link('catalog/tshirtecommerce/index', 'token=' . $this->session->data['token'], 'SSL');
				$data['designer_settings'] 			= $this->url->link('module/tshirtecommerce', 'token=' . $this->session->data['token'], 'SSL');
				$data['designer_update'] 			= $this->url->link('catalog/tshirtecommerce/update', 'token=' . $this->session->data['token'], 'SSL');
			]]></add>
		</operation>		
	</file>	
	<file name="admin/view/template/common/menu.tpl">
		<operation error="skip">
			<search position="before"><![CDATA[<li id="extension">]]></search>
			<add><![CDATA[
				<li><a class="parent"><img src="https://tshirtecommerce.com/icon.png"/> <span>T-Shirt eCommerce</span></a>
					<ul>
						<li><a href="<?php echo $designer_build; ?>">Product Build</a></li>						
						<li><a href="<?php echo $designer_settings; ?>">Settings</a></li>
						<li><a href="<?php echo $designer_update; ?>">Update</a></li>
					</ul>
				</li>
			]]></add>
		</operation>
	</file>
	<file name="admin/controller/catalog/product.php">
		<operation error="skip">
			<search position="after"><![CDATA[$this->language->load('catalog/product');]]></search>
			<add><![CDATA[
				$this->load->model('user/user');

				$user_info 	= $this->model_user_user->getUser($this->user->getId());
				$logged 	= array(
					'login' => TRUE,
					'email' => $user_info['email'],
					'id' 	=> $user_info['user_id']
				);
				$SESSION['is_admin'] = $logged;
				$this->session->data['is_admin'] = $logged;
			]]></add>
		</operation>
		<operation error="skip">
			<search position="before"><![CDATA[catalog/product_form]]></search>
			<add><![CDATA[
				$this->load->model('tshirtecommerce/product');

				if(isset($this->request->get['product_id']))
				{
					$tshirtecommerce_data = $this->model_tshirtecommerce_product->get_product($this->request->get['product_id']);
					if($tshirtecommerce_data !== FALSE && count($tshirtecommerce_data) > 0)
					{
						$data['print_type'] 	= $tshirtecommerce_data['print_type'];
						$data['print_types'] 	= $tshirtecommerce_data['print_types'];
						$data['show_attribute'] = $tshirtecommerce_data['show_attribute'];
						$data['design'] 		= $tshirtecommerce_data['design'];
					}
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[catalog/product_form]]></search>
			<add><![CDATA[catalog/product_tshirtecommerce]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[$this->model_localisation_language->getLanguages();]]></search>
			<add><![CDATA[				
				if (isset($this->request->post['design_product_id']))
					$data['design_product_id'] = $this->request->post['design_product_id'];
				elseif (isset($product_info['design_product_id']))
					$data['design_product_id'] = $product_info['design_product_id'];
				else
					$data['design_product_id'] = '';

				if (isset($this->request->post['design_product_title_img']))
					$data['design_product_title_img'] = $this->request->post['design_product_title_img'];
				elseif (isset($product_info['design_product_title_img']))
					$data['design_product_title_img'] = $product_info['design_product_title_img'];
				else
					$data['design_product_title_img'] = '';
			]]></add>
		</operation>
	</file>
	<file name="admin/model/catalog/product.php">
		<operation error="skip">
			<search position="after"><![CDATA[$product_id = $this->db->getLastId();]]></search>
			<add><![CDATA[
				if (isset($data['design_product_id']))
					$this->db->query("UPDATE " . DB_PREFIX . "product SET design_product_id = '" . $this->db->escape($data['design_product_id']) . "' WHERE product_id = '" . (int)$product_id . "'");

				if (isset($data['design_product_title_img']))
					$this->db->query("UPDATE " . DB_PREFIX . "product SET design_product_title_img = '" . $this->db->escape($data['design_product_title_img']) . "' WHERE product_id = '" . (int)$product_id . "'");
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[public function editProduct($product_id, $data) {]]></search>
			<add><![CDATA[
				if (isset($data['design_product_id']))
					$this->db->query("UPDATE " . DB_PREFIX . "product SET design_product_id = '" . $this->db->escape($data['design_product_id']) . "' WHERE product_id = '" . (int)$product_id . "'");

				if (isset($data['design_product_title_img']))
					$this->db->query("UPDATE " . DB_PREFIX . "product SET design_product_title_img = '" . $this->db->escape($data['design_product_title_img']) . "' WHERE product_id = '" . (int)$product_id . "'");
			]]></add>
		</operation>			
	</file>
	<file name="admin/controller/sale/order.php">
		<operation error="skip">
			<search position="after" index="2"><![CDATA[$this->model_sale_order->getOrderProducts($this->request->get['order_id']);]]></search>
			<add><![CDATA[
				if(!defined('ROOT')) 	define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				if(!defined('DS')) 		define('DS', DIRECTORY_SEPARATOR);

				if(file_exists(ROOT.DS.'includes'.DS.'functions.php'))
				{
					include_once ROOT.DS.'includes'.DS.'functions.php';

					$dg 	= new dg();
					$lang 	= $dg->lang();

					$data['tshirtecommerce_designer_cart_edit'] 		= $lang['designer_cart_edit'];
					$data['tshirtecommerce_link_text_download'] 		= $lang['tshirtecommerce_link_text_download'];
					$data['tshirtecommerce_link_title_download'] 		= $lang['tshirtecommerce_link_title_download'];
					$data['tshirtecommerce_link_title_edit'] 			= $lang['tshirtecommerce_link_title_edit'];
					$data['tshirtecommerce_view_front'] 				= $lang['tshirtecommerce_view_front'];
					$data['tshirtecommerce_view_left'] 					= $lang['tshirtecommerce_view_left'];
					$data['tshirtecommerce_view_right'] 				= $lang['tshirtecommerce_view_right'];
					$data['tshirtecommerce_view_back'] 					= $lang['tshirtecommerce_view_back'];
					$data['ts_designer_clipart_edit_name'] 				= $lang['designer_clipart_edit_name'];
					$data['ts_designer_clipart_edit_number'] 			= $lang['designer_clipart_edit_number'];
					$data['tshirtecommerce_head_text_sizes'] 			= $lang['tshirtecommerce_head_text_sizes'];
					$data['tshirtecommerce_link_view_design'] 			= $lang['tshirtecommerce_link_view_design'];
					$data['tshirtecommerce_label_or_download_design'] 	= $lang['tshirtecommerce_label_or_download_design'];
					$data['tshirtecommerce_printing_type'] 				= $lang['tshirtecommerce_printing_type'];
				}

				$this->load->model('tshirtecommerce/order');

				if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1')))
					$base_url = HTTPS_CATALOG;
				else
					$base_url = HTTP_CATALOG;

				$data['base_url'] 				= $base_url;
				$data['tshirtecommerce_url'] 	= $this->url->link('tshirtecommerce/designer', '', 'SSL');
				$data['tshirtecommerce_url'] 	= str_replace('/admin', '', $data['tshirtecommerce_url']);
				$settings = $dg->getSetting();
				$data['store_enable'] = isset($settings->store->enable) ? $settings->store->enable : 0;

				$this->load->model('user/user');

				$user_info 	= $this->model_user_user->getUser($this->user->getId());
				$logged 	= array(
					'login' => TRUE,
					'email' => $user_info['email'],
					'id' 	=> $user_info['user_id']
				);
				$SESSION['is_admin'] = $logged;
				$this->session->data['is_admin'] = $logged;
			]]></add>
		</operation>
		<operation error="skip">
			<search position="before"><![CDATA[$data['products'][]]]></search>
			<add><![CDATA[
				$_data = $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']);
				$chk_return = false;
				// Check $design free or not
				$store_setting = array();
				$store_temp = array();
				$msg_store_empty = '';
				if(isset($dg) && $_data !== false && isset($_data->rowid))
				{
					$cache = $dg->cache('cart');
					$design = $cache->get($_data->rowid);
					$order_item = $design['item'];
					$arts = array();
					$prices = 0;
					$qty = (int) ($order_item['qty'] / 10);
					if($qty < 1) $qty = 1;
					
					if(isset($design['vector']))
					{
						$ids = array();
						$vectors = json_decode($design['vector'], true);
						if(count($vectors))
						{
							foreach($vectors as $view => $items)
							{
								if (count($items))
								{
									foreach($items as $item)
									{
										if (isset($item['clipar_type']) && empty($item['clipar_paid']))
										{
											if(empty($item['price'])) $item['price'] = 0;
											if(is_string($item['file']))
												$file = $item['file'];
											if(isset($item['file']['type']))
												$file = $item['file']['type'];
											$arts[$item['clipart_id']] = array(
												'view'	=> $view,
												'id'	=> $item['clipart_id'],
												'title'	=> $item['title'],
												'thumb'	=> $item['thumb'],
												'file'	=> $file,
												'price'	=> $item['price'],
											);
											if (!in_array($item['clipart_id'].'-'.$qty, $ids))
											{
												$prices = $prices + ($item['price'] * $qty);
												$ids[] 	= $item['clipart_id'].'-'.$qty;
											}
										}
									}
									// update info after paid
									if(isset($_GET['e_order_id']) && isset($_GET['params']) && count($ids) > 0 && $_data->rowid == $_GET['e_order_id'])
									{
										$e_order_id = $_GET['e_order_id'];
										$params = $_GET['params'];
										$settings = $dg->getSetting();
										$api = $settings->store->api;
										$this->model_tshirtecommerce_order->store_art_update($e_order_id, $params, array(), $api);
										//return $html;
										$chk_return = true;
									}
								}
							}
						}
					}
					if(count($arts) && $chk_return == false)
					{
						$settings = $dg->getSetting();
						if(empty($settings->store))
						{
							$msg_store_empty = '<p style="background-color: #fcf8e3;color:#8a6d3b;border: 1px solid #faebcc;padding:14px 12px;margin: 0px;">Your order using arts of <a href="http://store.9file.net/" target="_blank">store</a>. You missing setup API Store. Please go to <strong>T-Shirt eCommerce > Settings > Configuration > Tab Config</strong> setup store to download file output.</p>';
						}
						elseif(empty($settings->store->api) || (isset($settings->store->api) && $settings->store->api == ''))
						{
							$msg_store_empty = '<p style="background-color: #fcf8e3;color:#8a6d3b;border: 1px solid #faebcc;padding:14px 12px;margin: 0px;">Your order using arts of <a href="http://store.9file.net/" target="_blank">store</a>. You missing setup API Store. Please go to <strong>T-Shirt eCommerce > Settings > Configuration > Tab Config</strong> setup store to download file output.</p>';
						}
						else
						{
							$api = $settings->store->api;
							$store_temp['api'] = $api;
							$store_temp['ids'] = $ids;
							$store_temp['ids'] = $ids;
							$store_temp['prices'] = $prices;
							$store_temp['arts'] = $arts;
							$store_temp['qty'] = $qty;
						}
					}
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[$data['products'][]]]></search>
			<add><![CDATA[
				'design' => $_data,
				'_design' => isset($design) ? $design : array(),
				'store_temp' => $store_temp,
				'msg_store_empty' => $msg_store_empty,
				'u_return' => $chk_return,
			]]></add>
		</operation>
	</file>
	<file name="admin/view/template/sale/order_info.tpl">
		<operation error="skip">
			<search position="after"><![CDATA[echo $product['name']]]></search>
			<add><![CDATA[
			<?php 
			echo '<br />';
			$design = $product['design'];
			if(isset($store_enable) && $store_enable == 1)
			{
				if(!empty($product['msg_store_empty']))
				{
					echo $product['msg_store_empty'];
				}
				else
				{
					if(count($product['store_temp']) > 0 && $product['u_return'] == false)
					{
						$store_temp = $product['store_temp'];
						echo '<div class="tshirt-header-storearts"><span class="lbl">Arts of Store</span><div>';
						// Load css and javascript (store.js/css)
						echo '<link href="'.$base_url.'/tshirtecommerce/opencart/css/store.css" rel="stylesheet">';
						echo '<script> var store_ajaxurl = "'.$base_url.'"; </script>';
						echo '<script src="'.$base_url.'/tshirtecommerce/opencart/js/store.js"></script>';
						if($store_temp['prices'] > 0)
						{
							echo '<p class="tshirt-alertpayment">Your order using arts of store with cost <strong>'.$store_temp['prices'].' Credits</strong>. Please payment before download file output. <a href="http://store.9file.net/" target="_blank">Read More</a></p>';
							echo '<p class="btnpaymentnow"><a href="javascript:void(0);" data-id="'.$store_temp['api'].'/'.implode('_', $store_temp['ids']).'/'.$design->rowid.'" onclick="payment.load(this);">Payment Now!</a></p>';
							echo '<script type="text/javascript">jQuery(document).ready(function(){payment.removeLink(\''.$design->rowid.'\');});</script>';
						}
						else
						{
							echo '<script type="text/javascript">jQuery(document).ready(function(){payment.key(\''.$store_temp['api'].'\', \''.implode('_', $store_temp['ids']).'\', \''.$design->rowid.'\')});</script>';
						}
						echo '<div class="arts-store table-responsive" style="overflow: hidden;"><table cellpadding="0" cellspacing="0" width="100%" class="tshirtecommerce-store-arts-order">';
						echo '<thead><tr><th>Position</th><th>Image</th><th>Price & Info</th></tr></thead><tbody>';
						foreach($store_temp['arts'] as $art)
						{
							if ($art['price'] == 0)
							{
								$price_txt = '<strong>FREE</strong>';
							}
							else
							{
								$price_txt = 'Price: <strong>'.($art['price']*$store_temp['qty']).' Credits</strong><br />';
								$price_txt .= 'Quantity: <strong>'.$store_temp['qty'].'</strong>';
							}
							echo '<tr><td>'.$art['view'].'</td><td><a href="http://store.9file.net/arts/detail/'.$art['id'].'" target="_blank"><img width="100" src="'.$art['thumb'].'" alt="'.$art['title'].'" title="'.$art['title'].'"></a></td><td> '.$price_txt.'<br />File type: <strong>'.strtoupper($art['file']).'</strong></td></tr>';
						}
						echo '</tbody></table><div class="arts-store-payment"></div></div></div></div>';
					}
				}
			}
			?>
			<?php if(isset($product['design']) && $product['design'] != false)
			{	
				$design = $product['design'];

				if(isset($design->design_product_id) && !empty($design->design_product_id))
				{
					$_temp_arr = explode(':', $design->design_product_id);

					echo "<p class='form-group'>";

					if(count($_temp_arr) > 1)
					{
						$_key = $_temp_arr[0].':'.$_temp_arr[1].':'.$_temp_arr[2].':'.$design->color_hex;

						echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$_temp_arr[2]. '&parent_id=' . $design->product_id ."&cart_id=".$design->rowid."' title='".$tshirtecommerce_link_title_edit."' target='_blank'><strong>".$tshirtecommerce_link_view_design."</strong></a>";

						if(!isset($design->images) || empty($design->images))
						{
							echo ' '. $tshirtecommerce_label_or_download_design .':';

							echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=front'><strong>".$tshirtecommerce_view_front."</strong></a> - ";

							echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=back'><strong>".$tshirtecommerce_view_back."</strong></a> - ";

							echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=left'><strong>".$tshirtecommerce_view_left."</strong></a> - ";

							echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=right'><strong>".$tshirtecommerce_view_right."</strong></a>";
						}
					}
					else
					{
						if(isset($design->images) && !empty($design->images))
						{
							echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$design->design_product_id."&parent_id=".$design->product_id."&cart_id=".$design->rowid."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";
						}
					}
					echo "</p>";
				}
				if(isset($design->color_title))
				{ ?>
					<small><strong>Color:</strong> <span title="<?php echo $design->color_title; ?>" style="background-color:#<?php echo $design->color_hex; ?>;display:inline-block;border:1px solid #ccc;width:25px;height:25px;cursor:pointer;outline:1px solid #229BCA;margin-left 4px;"></span></small><br />
				<?php }
				/* options */
				if (isset($design->options) && $design->options != '[]')
				{
					if (is_string($design->options))
					{
						$design_options = json_decode( str_replace('&quot;', '"', $design->options) );
					}
					else
					{
						$design_options = $design->options;						
					}
					$html = '';
					if (count($design_options))
					{
						foreach($design_options as $option)
						{					
							if (isset($option->value))
							{
								if (is_string($option->value) && $option->value != '')
								{
									// Fixed Printing type is empty
									if(empty($option->name) && $option->type == 'printing') $option->name = $tshirtecommerce_printing_type; //'Printing type'

									$html .= '<dt>'.$option->name.': '.$option->value.'</dt>';
								}
								else if (count($option->value) > 0)
								{
									$html .= '<dt>'.$option->name.': </dt>';
									$html .=  '<dd>';
									foreach ($option->value as $name => $value)
									{
										if($option->type == 'checkbox')
										{
											$html .=  $value. '; ';
										}
										else
										{
											if($value != '0' && $value != 0) $html .= $name.'  -  '.$value. '; ';
										}
									}
									$html .=  '</dd>';
								}
							}
						}
					}
					echo $html;
				}
				/* teams */
				if (isset($design->teams) && isset($design->teams->name))
				{
					$teams = json_decode( json_encode($design->teams), true);

					$table = '<table class="table table-bordered">'
						. 		'<thead>'
						. 			'<tr>'
						. 				'<th>'.$ts_designer_clipart_edit_name.'</th>'
						. 				'<th>'.$ts_designer_clipart_edit_number.'</th>'
						. 				'<th>'.$tshirtecommerce_head_text_sizes.'</th>'
						. 			'</tr>'
						. 		'</thead>'
						. 		'<tbody>';
					for($i=1; $i<=count($teams['name']); $i++)
					{
						$size = explode('::', $teams['size'][$i]);

						$table .=	'<tr>'
							.			'<td>'.$teams['name'][$i].'</td>'
							.			'<td>'.$teams['number'][$i].'</td>'
							.			'<td>'.$size[0].'</td>'
							.		'</tr>';
					}
					$table .= '</tbody></table>';

					echo $table;
				}

				/* images */
				if (isset($design->images))
				{
					$images = json_decode(str_replace('&quot;', '"', $design->images), true);
					if (count($images) > 0)
					{								
						$img = '';
						foreach($images as $view => $src)
						{
							$img .= '<div class="img-thumbnail" style="margin:2px;text-align:center;"><img style="width:100px;" src="'.$base_url.'/tshirtecommerce/'.$src.'" alt="" title=""><br />'
								. '<a style="width:100%" href="'.$base_url.'/tshirtecommerce/design.php?key='.$design->rowid.'&view='.$view.'" target="_blank" class="pull-right" title="'.$tshirtecommerce_link_title_download.'">'.$tshirtecommerce_link_text_download.'</a></div>';
						}
						echo $img;
					}
				}
		 	} ?>
			]]></add>
		</operation>
	</file>
	<!-- END ADMIN -->

	<!-- FRONT -->
	<file name="catalog/controller/account/account.php">
		<operation error="skip">
			<search position="after"><![CDATA[$data['heading_title']]]></search>
			<add><![CDATA[
				$logged = array(
					'login' => TRUE,
					'email' => $this->customer->getEmail(),
					'id' 	=> $this->customer->isLogged()
				);
				$_SESSION['is_logged'] = $logged;
				$this->session->data['is_logged'] = $logged;
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/checkout/login.php">
		<operation error="skip">
			<search position="after"><![CDATA[$this->load->model('account/activity');]]></search>
			<add><![CDATA[
				$logged = array(
					'login' => TRUE,
					'email' => $this->customer->getEmail(),
					'id' 	=> $this->customer->getId()
				);
				$_SESSION['is_logged'] = $logged;
				$this->session->data['is_logged'] = $logged;
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/account/logout.php">
		<operation error="skip">
			<search position="after"><![CDATA[$this->customer->logout();]]></search>
			<add><![CDATA[
				unset($_SESSION['is_logged']);
				unset($this->session->data['is_logged']);
			]]></add>
		</operation>
	</file>
	<file name="catalog/model/catalog/product.php">
		<operation error="skip">
			<search position="after"><![CDATA[$query->row['product_id']]]></search>
			<add><![CDATA[ 
				'design_product_id' 		=> $query->row['design_product_id'],
				'design_product_title_img' 	=> $query->row['design_product_title_img'],
			]]></add>
		</operation>		
	</file>
	<file name="catalog/controller/product/product.php">
		<operation error="skip">
			<search position="before" index="1"><![CDATA[$this->load->model('catalog/review')]]></search>
			<add><![CDATA[
				if(!defined('ROOT')) 	define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				if(!defined('DS')) 		define('DS', DIRECTORY_SEPARATOR);

				include_once ROOT . DS . 'includes' . DS . 'functions.php';

				$dg 	= new dg();
				$lang 	= $dg->lang();

				$data['tshirtecommerce_label_price_of_print'] 		= $lang['tshirtecommerce_label_price_of_print'];
				$data['tshirtecommerce_button_custom_your_design'] 	= $lang['tshirtecommerce_button_custom_your_design'];
				$data['tshirtecommerce_warning_alert_order'] 		= $lang['tshirtecommerce_warning_alert_order'];
				$data['tshirtecommerce_printing_type'] 				= $lang['tshirtecommerce_printing_type'];

				$data['oc_quantity'] 								=  0;

				if (isset($product_info['quantity'])) $data['oc_quantity'] = $product_info['quantity'];

				$data['oc_minimum'] =  0;
				if (isset($product_info['minimum'])) $data['oc_minimum'] = $product_info['minimum'];

				if (isset($product_info['design_product_id'])) $data['design_product_id'] = $product_info['design_product_id'];
				else $data['design_product_id'] =  '';

				if (isset($product_info['design_product_title_img']))
				{
					$data['design_product_title_img'] 	= $product_info['design_product_title_img'];
					$temp 								= explode('::', $data['design_product_title_img']);

					if (isset($temp[2]))
					{
						if ($data['design_product_id'] != '')
						{
							$data['design_print_price'] 	  = (float)$temp[2];
							$data['design_print_price_lable'] = $this->currency->format($data['design_print_price'], $this->session->data['currency']);
						}
						else
						{
							$data['design_print_price'] = 0;
						}
					}
					else
					{
						$data['design_print_price'] =  0;
					}
				}
				else
				{
					$data['design_product_title_img'] 	=  '';
					$data['design_print_price'] 		=  0;
				}

				// Get Style for custom design button
				$this->load->model('setting/setting');
				if(null !== $this->config->get('tshirtecommerce_customize_design_btn'))
				{
					$data['tshirtecommerce_customize_design_btn'] = $this->config->get('tshirtecommerce_customize_design_btn');
				}
				else
				{
					$data['tshirtecommerce_customize_design_btn'] = 'color: #ffffff;text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);background-color: #5bb75b;background-image: linear-gradient(to bottom, #62c462, #51a351);background-repeat: repeat-x;border-color: #51a351 #51a351 #387038;padding: 10px 16px;font-size: 15px;border-radius: 4px;box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.05);width: 100%;display: block;line-height: 1.3333333;font-weight: 400;text-align: center;';
				}

				if(null !== $this->config->get('tshirtecommerce_hide_addtocart'))
				{
					$data['tshirtecommerce_hide_addtocart'] = $this->config->get('tshirtecommerce_hide_addtocart');
				}
				else
				{
					$data['tshirtecommerce_hide_addtocart'] = 0;
				}

				// Get base url
				if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1')))
				{
		         	$site_url = $this->config->get('config_ssl');
			    }
			    else
			    {
			        $site_url = $this->config->get('config_url');
			    }
			    $data['site_url'] = $site_url;
			]]></add>
		</operation>		
	</file>
	<file name="catalog/view/theme/*/template/product/product.tpl">
		<operation error="skip">
			<search position="before"><![CDATA[id="button-cart"]]></search>
			<add><![CDATA[
				<?php $e_validate_input_order 	= false; ?>
				<ul class="list-unstyled">
					<?php
						$design_product_id_arr 	= explode(':', $design_product_id);
						$e_design_product_id 	= 0;

						if(count($design_product_id_arr) > 1) $e_design_product_id = isset($design_product_id_arr[2]) ? $design_product_id_arr[2] : 0;
						else $e_design_product_id = $design_product_id;

						$file = dirname(DIR_SYSTEM) . '/tshirtecommerce/data/products.json';
						if (file_exists($file))
						{			
							$string = file_get_contents($file);
							if ($string != false)
							{
								$e_products = json_decode($string);
								if ( isset($e_products->products) && count($e_products->products) > 0)
								{
									foreach($e_products->products as $values)
									{
										if(isset($e_design_product_id) && $e_design_product_id != '' && $e_design_product_id == $values->id && isset($values->show_attribute))
										{ ?>
											<div class="row designer-attributes">
												<link href="<?php echo $site_url; ?>/tshirtecommerce/opencart/css/product.css" rel="stylesheet">
												<script src="<?php echo $site_url; ?>/tshirtecommerce/opencart/js/product.js"></script>
												<?php if(isset($values->design) && isset($values->design->color_hex)) : ?>
												<div class='list-colors' style='margin-bottom:15px;'>
													<?php $color_hex_count = count($values->design->color_hex);
													for($color_hex_c = 0; $color_hex_c < $color_hex_count; $color_hex_c++) : ?>
													<a href="javascript:void(0);" onclick="e_productColor(this)" data-color="<?php echo $values->design->color_hex[$color_hex_c] ?>" data-index="<?php echo $color_hex_c ?>" class="bg-colors <?php if(isset($design_product_id_arr[3]) && $values->design->color_hex[$color_hex_c] == $design_product_id_arr[3]) {echo 'active';}else{if($color_hex_c==0) echo 'active';}?>" title="<?php echo $values->design->color_title[$color_hex_c] ?>"><span style="width:24px;background-color:#<?php echo $values->design->color_hex[$color_hex_c] ?>;"></span></a>
													<?php endfor; ?>
													<input type='hidden' value='<?php echo (isset($design_product_id_arr[0]) ? $design_product_id_arr[0] : '') ?>' name='design[rowid]' id='e_rowid' />
													<input type="hidden" value="<?php echo (isset($design_product_id_arr[3]) ? $design_product_id_arr[3] : $values->design->color_hex[0]) ?>" id='e_color_hex' name="design[color_hex]" />
													<input type="hidden" value="<?php echo $values->design->color_title[0] ?>" name="design[color_title]" />
													<input type="hidden" value="<?php echo $values->id ?>" name="design_product_id" />
													<input type="hidden" value="<?php echo $values->id ?>" name="design[design_product_id]" />
													<input type="hidden" value="" name="design[images]" />
													<input type="hidden" value="1" name="design[idea]" />
												</div>
												<?php endif; ?>
												<?php if(isset($values->show_attribute) && $values->show_attribute == 1 && ! empty($values->attributes))
												{
													$e_validate_input_order = true; ?>
													
													<div class='product-attributes'>
														<input type='hidden' value='<?php echo $oc_minimum ?>' id='e-input-min-order' />
														<input type='hidden' value='<?php echo $oc_quantity ?>' id='e-input-max-order' />
														<?php $e_attr_count = count($values->attributes->name);
														echo '<input type="hidden" value="'.$product_id.'" name="design[product_id]" />';
														for($ia = 0; $ia < $e_attr_count; $ia++) : ?>
														<div class='form-group product-fields' style='margin-bottom:0!important'><p><strong><?php echo $values->attributes->name[$ia] ?></strong></p></div>
														<div class='dg-poduct-fields'>
															<input type='hidden' value='<?php echo $values->attributes->name[$ia] ?>' name='design[options][<?php echo $ia ?>][name]' />
															<input type='hidden' value='<?php echo $values->attributes->type[$ia] ?>' name='design[options][<?php echo $ia ?>][type]' />
															<?php switch($values->attributes->type[$ia])
															{
																case 'textlist':
																	echo "<script>document.getElementsByName('quantity')[0].disabled = true;</script><ul id='e-input-options' class='p-color-sizes list-number col-md-12' style='width:100%'>";
																	$iaj = 0;
																	foreach($values->attributes->titles[$ia] as $value)
																	{
																		echo "<li style='padding-bottom:10px'>";
																		echo "<label>";
																		if(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] > 0)
																		{
																			echo $value . '(+' . $values->attributes->prices[$ia][$iaj] . ')';
																		}
																		elseif(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] < 0)
																		{
																			echo $value . '(' . $values->attributes->prices[$ia][$iaj] . ')';
																		}
																		else
																		{
																			echo $value;
																		}
																		echo "</label>";

																		if ($iaj == 0)
																		{
																			echo "<input type='text' class='form-control input-sm size-number' name='design[options][$ia][value][$value]' value='$oc_minimum' onchange='e_tshirt_attributes(this, $iaj)' onkeypress='return e_validate_num(event, this)' />";
																		}
																		else
																		{
																			echo "<input type='text' class='form-control input-sm size-number' name='design[options][$ia][value][$value]' value='0' onchange='e_tshirt_attributes(this, $iaj)' onkeypress='return e_validate_num(event, this)' />";
																		}
																		echo "<input type='hidden' name='design[options][$ia][price][$value]' value='".(isset($values->attributes->prices[$ia][$iaj]) ? $values->attributes->prices[$ia][$iaj] : 0)."' />";

																		$iaj++;
																	}
																	break;
																case 'checkbox':
																	$iaj = 0;
																	echo "<div class='form-group'>";
																	foreach($values->attributes->titles[$ia] as $value)
																	{
																		echo '<p><label class="checkbox-inline">';
																		if(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] > 0)
																		{
																			echo "<input type='checkbox' name='design[options][$ia][value][$iaj]' value='$value' />";
																			echo $value .'(+' . $values->attributes->prices[$ia][$iaj] . ')';
																		}
																		elseif(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] < 0)
																		{
																			echo "<input type='checkbox' name='design[options][$ia][value][$iaj]' value='$value' />";
																			echo $value .'(' . $values->attributes->prices[$ia][$iaj] . ')';
																		}
																		else
																		{
																			echo "<input type='checkbox' name='design[options][$ia][value][$iaj]' value='$value' />";
																			echo $value;
																		}
																		echo '</label></p>';

																		$iaj++;
																	}
																	echo '</div>';
																	break;
																case 'selectbox':
																	$iaj = 0;
																	echo "<div class='form-group'>";
																	echo "<select class='form-control input-sm' name='design[options][$ia][value]'>";
																	foreach($values->attributes->titles[$ia] as $value)
																	{
																		if(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] > 0)
																		{
																			echo "<option value='$value'>$value (+".$values->attributes->prices[$ia][$iaj].")</option>";
																		}
																		elseif(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] < 0)
																		{
																			echo "<option value='$value'>$value (".$values->attributes->prices[$ia][$iaj].")</option>";
																		}
																		else
																		{
																			echo "<option value='$value'>$value</option>";
																		}
																		$iaj++;
																	}
																	echo '</select>';
																	echo '</div>';
																	break;
																case 'radio';
																	$iaj = 0;
																	echo "<div class='form-group'>";
																	foreach($values->attributes->titles[$ia] as $value)
																	{
																		echo '<p><label class="radio-inline">';
																		if(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] > 0)
																		{
																			echo "<input type='radio' value='$value' name='design[options][$ia][value]' />";
																			echo $value .'(+' . $values->attributes->prices[$ia][$iaj] . ')';
																		}
																		elseif(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] < 0)
																		{
																			echo "<input type='radio' value='$value' name='design[options][$ia][value]' />";
																			echo $value .'(' . $values->attributes->prices[$ia][$iaj] . ')';
																		}
																		else
																		{
																			echo "<input type='radio' value='$value' name='design[options][$ia][value][$value]' />";
																			echo $value;
																		}
																		echo '</label></p>';
																		$iaj++;
																	}
																	echo '</div>';
																	break;
																default:
																	break;
															} ?>
														</div>
														<?php endfor; 
														echo '<input type="hidden" value="'.$tshirtecommerce_printing_type.'" name="design[options]['.$e_attr_count.'][name]" />';
														echo '<input type="hidden" value="printing" name="design[options]['.$e_attr_count.'][type]" />';
														echo '<input type="hidden" value="'. $values->print_type .'" name="design[options]['.$e_attr_count.'][value]" />'; ?>
													</div>
													<div class='clear:both;'></div>
												<?php } ?>
											</div>
										<?php }
									}
								}
							}
						} ?>
				</ul>
				<?php if(isset($design_product_id) && $design_product_id != '')
				{
					$check_idea = explode(':', $design_product_id);
					$parent_id 	= $product_id;

					if (count($check_idea) > 1)
					{ ?>
						<?php if (isset($design_print_price) && $design_print_price != 0) { ?>
						<p><label class="control-label"><?php echo $tshirtecommerce_label_price_of_print; ?> <strong>+<?php echo $design_print_price_lable; ?></strong></label></p>
						<input name='design[oc_price_of_print]' type='hidden' value='<?php echo $design_print_price ?>' />
						<?php } ?>
					<?php } ?>
					<div style='clear:both'></div>
					<?php if(isset($tshirtecommerce_hide_addtocart) && $tshirtecommerce_hide_addtocart == 1) { ?>
					<style>#button-cart{display:none !important;}</style>
					<?php } ?>
					<a id="button-design" data-color='' style='<?php if(isset($tshirtecommerce_customize_design_btn)) echo $tshirtecommerce_customize_design_btn; ?>' onclick='return loadProductDesign(this);' 
						href="index.php?route=tshirtecommerce/designer&product_id=<?php echo $design_product_id; ?>&parent_id=<?php echo $parent_id; ?>"><?php echo $tshirtecommerce_button_custom_your_design; ?></a>
					
				<?php } ?>
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/checkout/cart.php">
		<operation error="skip">
			<search position="before"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				if(!defined('ROOT')) define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				if(!defined('DS')) define('DS', DIRECTORY_SEPARATOR);

				include_once ROOT . DS . 'includes' . DS . 'functions.php';

				$dg 	= new dg();
				$lang 	= $dg->lang();

				$data['tshirtecommerce_designer_cart_edit'] = $lang['designer_cart_edit'];
				$data['tshirtecommerce_printing_type'] 		= $lang['tshirtecommerce_printing_type'];

				if (isset($product['design']) && $product['design'] != false && isset($product['design']['rowid']))
				{					
					$design = $product['design'];
					$item 	= $this->db->query("SELECT product_id, design_product_id FROM `" . DB_PREFIX . "product` WHERE status = 1 AND product_id = '".$product['design']['product_id']."'");

					$design_product_id = 0;
					if ($item->num_rows) $design_product_id = $item->row['design_product_id'];

					$keys = explode(':', $design_product_id); //$design['color_hex']
					if(count($keys) > 1 && isset($keys[3]) && isset($design['color_hex'])) 
					{
						$keys[3] 			= $design['color_hex'];
						$design_product_id 	= $keys[0].':'.$keys[1].':'.$keys[2].':'.$keys[3];
					}
					$product['design']['design_product_id'] = $design_product_id;

					/* images */
					if (isset($design['images']))
					{
						$images = json_decode(str_replace('&quot;', '"', $design['images']), true);

						if (count($images) > 0)
						{
							if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1')))
								$base_url = $this->config->get('config_ssl');
							else
								$base_url = $this->config->get('config_url');

							$img = '';
							foreach($images as $view => $src)
							{
								$img .= '<a href="'.$base_url.'/tshirtecommerce/'.$src.'"><img style="width:100px; margin:1%;" src="'.$base_url.'/tshirtecommerce/'.$src.'" alt="" title="" class="img-thumbnail"></a>';
							}
							$design_option = array(
								'name'	=> 'Images',
								'value'	=> '<br /><div>'.$img.'</div>'
							);
							$option_data[] = $design_option;
						}
					}

					/* colors */
					$design_option = array(
						'name'	=> 'Color',
						'value'	=> '<span title="'.$design['color_title'].'" style="background-color:#'.$design['color_hex'].';display:inline-block;border:1px solid #ccc;width:25px;height:25px;cursor:pointer;outline:1px solid #229BCA;margin-left 4px;"></span>'
					);
					$option_data[] = $design_option;
					
					/* options */
					if (isset($design['options']) && $design['options'] != '[]')
					{
						if (is_string($design['options'])) $design_options = json_decode( str_replace('&quot;', '"', $design['options']) );
						else $design_options = $design['options'];

						$html = '';
						for($i=0; $i<count($design_options); $i++)
						{
							if (empty($design_options[$i]['value'])) continue;

							if (is_string($design_options[$i]['value']) && $design_options[$i]['value'] != '')
							{
								// Fixed Printing type is empty
								if(empty($design_options[$i]['name']) && $design_options[$i]['type'] == 'printing')
									$design_options[$i]['name'] = $data['tshirtecommerce_printing_type']; //'Printing type'

								$html .= '<dt>'.$design_options[$i]['name'].': '.$design_options[$i]['value'].'</dt>';
							}
							elseif (count($design_options[$i]['value']) > 0)
							{
								$html .= '<dt>'.$design_options[$i]['name'].': </dt>';
								$html .=  '<dd>';

								foreach ($design_options[$i]['value'] as $name => $value)
								{
									if($design_options[$i]['type'] == 'checkbox')
									{
										$html .=  $value. '; ';
									}
									else
									{
										if($value != '0' && $value != 0)
											$html .=  $name.'  -  '.$value. '; ';
									}
								}
								$html .=  '</dd>';
							}
						}
						$design_option = array(
							'name'	=> 'Options',
							'value'	=> $html
						);
						$option_data[] = $design_option;
					}

					/* teams */
					if (isset($design['teams']) && isset($design['teams']['name']) )
					{
						$table = '<table class="table table-bordered">'
							. 		'<thead>'
							. 			'<tr>'
							. 				'<th>Name</th>'
							. 				'<th>Number</th>'
							. 				'<th>Sizes</th>'
							. 			'</tr>'
							. 		'</thead>'
							. 		'<tbody>';
							
						for($i=1; $i<=count($design['teams']['name']); $i++ )
						{
							$size = explode('::', $design['teams']['size'][$i]);
							$table .=	'<tr>'
								.			'<td>'.$design['teams']['name'][$i].'</td>'
								.			'<td>'.$design['teams']['number'][$i].'</td>'
								.			'<td>'.$size[0].'</td>'
								.		'</tr>';
						}
						$table .= '</tbody></table>';
						$design_option = array(
							'name'	=> 'Team',
							'value'	=> $table
						);
						$option_data[] = $design_option;
					}
				}
				else
				{
					$design = '';					
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				'order_id' 			=> (isset($product['design']['rowid']) ? $product['design']['rowid'] : 0),
				'parent_id' 		=> (isset($product['design']['product_id']) ? $product['design']['product_id'] : 0),
				'design_product_id' => (isset($design_product_id) ? $design_product_id : 0),
			]]></add>
		</operation>
		<!-- @todo{3} Added July, -5, 2016 by phinq -->
		<operation error="skip">
			<search position="before"><![CDATA[isset($this->request->post['option'])]]></search>
			<add><![CDATA[
				if(isset($this->request->post['design']) 
					&& isset($this->request->post['design']['option_oc']) 
					&& count($this->request->post['design']['option_oc']) > 0)
				{
					$_options 	= array();
					$options_oc = $this->request->post['design']['option_oc'];

					foreach($options_oc as $idx => $option)
					{
						if(!empty($option)) $_options[$idx] = $option;
					}
					$this->request->post['option'] = $_options;
				}
			]]></add>
		</operation>
		<!-- Ended @todo{3} -->
	</file>
	<file name="catalog/controller/checkout/confirm.php">
		<operation error="skip">
			<search position="before"><![CDATA[$order_data['products'][] = array(]]></search>
			<add><![CDATA[
				if (isset($product['design']))
				{
					$design_product_id = '';
					if(isset($product['design']['product_id']))
					{
						$item = $this->db->query("SELECT product_id, design_product_id FROM `" . DB_PREFIX . "product` WHERE status = 1 AND product_id = '".$product['design']['product_id']."'");

						if ($item->num_rows) $design_product_id = $item->row['design_product_id'];
					}

					$product['design']['design_product_id'] = $design_product_id;
					$design 								= json_encode($product['design']);
				}
				else
				{
					$design = '';
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="before"><![CDATA[$this->tax->getTax($product['price'], $product['tax_class_id']),]]></search>
			<add><![CDATA[
			'design' => $design,
			]]></add>
		</operation>
	</file>
	<file name="catalog/model/checkout/order.php">
		<operation error="skip">
			<search position="after" index="1"><![CDATA[$order_product_id = $this->db->getLastId();]]></search>
			<add><![CDATA[
				if ( isset($product['design']) && $product['design'] != '' )
				{
					$this->db->query("INSERT INTO " . DB_PREFIX . "tshirtdesign_order SET order_product_id = '" . (int)$order_product_id . "', options = '" . $this->db->escape($product['design']) . "'");
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[$data = array();]]></search>
			<add><![CDATA[
				$this->load->model('tshirtecommerce/order');

				if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1')))
					$base_url = $this->config->get('config_ssl');
				else
					$base_url = $this->config->get('config_url');

				$data['base_url'] = $base_url;
			]]></add>
		</operation>
		<operation error="skip">
			<search position="before"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				if(!defined('ROOT')) 	define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				if(!defined('DS')) 		define('DS', DIRECTORY_SEPARATOR);

				if(file_exists(ROOT . DS . 'includes' . DS . 'functions.php'))
				{
					include_once ROOT . DS . 'includes' . DS . 'functions.php';

					$dg 	= new dg();
					$lang 	= $dg->lang();

					$data['tshirtecommerce_designer_cart_edit'] 		= $lang['designer_cart_edit'];
					$data['tshirtecommerce_link_text_download'] 		= $lang['tshirtecommerce_link_text_download'];
					$data['tshirtecommerce_link_title_download'] 		= $lang['tshirtecommerce_link_title_download'];
					$data['tshirtecommerce_link_title_edit'] 			= $lang['tshirtecommerce_link_title_edit'];
					$data['tshirtecommerce_view_front'] 				= $lang['tshirtecommerce_view_front'];
					$data['tshirtecommerce_view_left'] 					= $lang['tshirtecommerce_view_left'];
					$data['tshirtecommerce_view_right'] 				= $lang['tshirtecommerce_view_right'];
					$data['tshirtecommerce_view_back'] 					= $lang['tshirtecommerce_view_back'];
					$data['ts_designer_clipart_edit_name'] 				= $lang['designer_clipart_edit_name'];
					$data['ts_designer_clipart_edit_number'] 			= $lang['designer_clipart_edit_number'];
					$data['tshirtecommerce_head_text_sizes'] 			= $lang['tshirtecommerce_head_text_sizes'];
					$data['tshirtecommerce_link_view_design'] 			= $lang['tshirtecommerce_link_view_design'];
					$data['tshirtecommerce_label_or_download_design'] 	= $lang['tshirtecommerce_label_or_download_design'];
					$data['tshirtecommerce_label_color'] 				= $lang['tshirtecommerce_label_color'];
				}

				$this->load->model('setting/setting');

				if(null !== $this->config->get('tshirtecommerce_downloadable'))
					$data['tshirtecommerce_downloadable'] = $this->config->get('tshirtecommerce_downloadable');
				else
					$data['tshirtecommerce_downloadable'] = 0;

				$this->load->model('catalog/product');

				$e_products 		= $this->model_catalog_product->getProduct($product['product_id']);
				$design_product_id 	= '';

				if(isset($e_products) && isset($e_products['design_product_id'])) $design_product_id = $e_products['design_product_id'];

				$settings = $dg->getSetting();
				$data['store_enable'] = isset($settings->store->enable) ? $settings->store->enable : 0;

				$_data = $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']);
				$chk_return = false;
				// Check $design free or not
				$store_setting = array();
				$store_temp = array();
				$msg_store_empty = '';
				if(isset($dg) && $_data !== false && isset($_data->rowid))
				{
					$cache = $dg->cache('cart');
					$design = $cache->get($_data->rowid);
					$order_item = $design['item'];
					$arts = array();
					$prices = 0;
					$qty = (int) ($order_item['qty'] / 10);
					if($qty < 1) $qty = 1;

					if(isset($design['vector']))
					{
						$ids = array();
						$vectors = json_decode($design['vector'], true);
						if(count($vectors))
						{
							foreach($vectors as $view => $items)
							{
								if (count($items))
								{
									foreach($items as $item)
									{
										if (isset($item['clipar_type']) && empty($item['clipar_paid']))
										{
											if(empty($item['price'])) $item['price'] = 0;
											if(is_string($item['file']))
												$file = $item['file'];
											if(isset($item['file']['type']))
												$file = $item['file']['type'];
											$arts[$item['clipart_id']] = array(
												'view'	=> $view,
												'id'	=> $item['clipart_id'],
												'title'	=> $item['title'],
												'thumb'	=> $item['thumb'],
												'file'	=> $file,
												'price'	=> $item['price'],
											);
											if (!in_array($item['clipart_id'].'-'.$qty, $ids))
											{
												$prices = $prices + ($item['price'] * $qty);
												$ids[] 	= $item['clipart_id'].'-'.$qty;
											}
										}
									}
									// update info after paid
									if(isset($_GET['e_order_id']) && isset($_GET['params']) && count($ids) > 0 && $data['design_id'] == $_GET['e_order_id'])
									{
										$e_order_id = $_GET['e_order_id'];
										$params = $_GET['params'];
										$settings = $dg->getSetting();
										$api = $settings->store->api;
										store_art_update($e_order_id, $params, array(), $api);
										//return $html;
										$chk_return = true;
									}
								}
							}
						}
					}
					if(count($arts) && $chk_return == false)
					{
						$settings = $dg->getSetting();
						if(empty($settings->store))
						{
							$msg_store_empty = '<p style="background-color: #fcf8e3;color:#8a6d3b;border: 1px solid #faebcc;padding:14px 12px;margin: 0px;">Your order using arts of <a href="http://store.9file.net/" target="_blank">store</a>. You missing setup API Store. Please go to <strong>T-Shirt eCommerce > Settings > Configuration > Tab Config</strong> setup store to download file output.</p>';
						}
						elseif(empty($settings->store->api) || (isset($settings->store->api) && $settings->store->api == ''))
						{
							$msg_store_empty = '<p style="background-color: #fcf8e3;color:#8a6d3b;border: 1px solid #faebcc;padding:14px 12px;margin: 0px;">Your order using arts of <a href="http://store.9file.net/" target="_blank">store</a>. You missing setup API Store. Please go to <strong>T-Shirt eCommerce > Settings > Configuration > Tab Config</strong> setup store to download file output.</p>';
						}
						else
						{
							$api = $settings->store->api;
							$store_temp['api'] = $api;
							$store_temp['ids'] = $ids;
							$store_temp['ids'] = $ids;
							$store_temp['prices'] = $prices;
							$store_temp['arts'] = $arts;
							$store_temp['qty'] = $qty;
						}
					}
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				'design' 			=> $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']),
				'link_edit' 		=> 'index.php?route=tshirtecommerce/designer&product_id=',
				'design_product_id' => $design_product_id,
				'_design' => isset($design) ? $design : array(),
				'store_temp' => $store_temp,
				'msg_store_empty' => $msg_store_empty,
				'u_return' => $chk_return,
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/checkout/cart.tpl">
		<operation error="skip">
			<search position="after"><![CDATA[echo $text_recurring_item]]></search>
			<add><![CDATA[
				<?php } ?>
				<br /> <br />
				<?php if( ! empty($product['order_id']) && $product['design_product_id'] != $product['order_id']) { ?>
				<a href="index.php?route=tshirtecommerce/designer&product_id=<?php echo $product['design_product_id'] ?>&parent_id=<?php echo $product['parent_id'] ?>&cart_id=<?php echo $product['order_id'] ?>&edit=<?php echo $product['cart_id']; ?>" title=""><?php echo $tshirtecommerce_designer_cart_edit ?></a>
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/account/order.php">
		<operation error="skip">
			<search position="after"><![CDATA[$this->model_account_order->getOrderProducts($this->request->get['order_id']);]]></search>
			<add><![CDATA[
				if(!defined('ROOT')) 	define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				if(!defined('DS')) 		define('DS', DIRECTORY_SEPARATOR);

				if(file_exists(ROOT . DS . 'includes' . DS . 'functions.php'))
				{
					include_once ROOT . DS . 'includes' . DS . 'functions.php';

					$dg 	= new dg();
					$lang 	= $dg->lang();

					$data['tshirtecommerce_designer_cart_edit'] 		= $lang['designer_cart_edit'];
					$data['tshirtecommerce_link_text_download'] 		= $lang['tshirtecommerce_link_text_download'];
					$data['tshirtecommerce_link_title_download'] 		= $lang['tshirtecommerce_link_title_download'];
					$data['tshirtecommerce_link_title_edit'] 			= $lang['tshirtecommerce_link_title_edit'];
					$data['tshirtecommerce_view_front'] 				= $lang['tshirtecommerce_view_front'];
					$data['tshirtecommerce_view_left'] 					= $lang['tshirtecommerce_view_left'];
					$data['tshirtecommerce_view_right'] 				= $lang['tshirtecommerce_view_right'];
					$data['tshirtecommerce_view_back'] 					= $lang['tshirtecommerce_view_back'];
					$data['ts_designer_clipart_edit_name'] 				= $lang['designer_clipart_edit_name'];
					$data['ts_designer_clipart_edit_number'] 			= $lang['designer_clipart_edit_number'];
					$data['tshirtecommerce_head_text_sizes'] 			= $lang['tshirtecommerce_head_text_sizes'];
					$data['tshirtecommerce_link_view_design'] 			= $lang['tshirtecommerce_link_view_design'];
					$data['tshirtecommerce_label_or_download_design'] 	= $lang['tshirtecommerce_label_or_download_design'];
					$data['tshirtecommerce_printing_type'] 				= $lang['tshirtecommerce_printing_type'];
				}

				$this->load->model('tshirtecommerce/order');

				if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1')))
					$base_url = $this->config->get('config_ssl');
				else
					$base_url = $this->config->get('config_url');

				$data['base_url'] = $base_url;

				$settings = $dg->getSetting();
				$data['store_enable'] = isset($settings->store->enable) ? $settings->store->enable : 0;
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[$option_data,]]></search>
			<add><![CDATA[
				'design' => $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']),
			]]></add>
		</operation>
		<operation error="skip">
			<search position="before"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				$this->load->model('setting/setting');

				if(null !== $this->config->get('tshirtecommerce_downloadable'))
					$data['tshirtecommerce_downloadable'] = $this->config->get('tshirtecommerce_downloadable');
				else
					$data['tshirtecommerce_downloadable'] = 0;

				$_data = $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']);
				$chk_return = false;
				// Check $design free or not
				$store_setting = array();
				$store_temp = array();
				$msg_store_empty = '';
				if(isset($dg) && $_data !== false && $isset($_data->rowid))
				{
					$cache = $dg->cache('cart');
					$design = $cache->get($_data->rowid);
					$order_item = $design['item'];
					$arts = array();
					$prices = 0;
					$qty = (int) ($order_item['qty'] / 10);
					if($qty < 1) $qty = 1;

					if(isset($design['vector']))
					{
						$ids = array();
						$vectors = json_decode($design['vector'], true);
						if(count($vectors))
						{
							foreach($vectors as $view => $items)
							{
								if (count($items))
								{
									foreach($items as $item)
									{
										if (isset($item['clipar_type']) && empty($item['clipar_paid']))
										{
											if(empty($item['price'])) $item['price'] = 0;
											if(is_string($item['file']))
												$file = $item['file'];
											if(isset($item['file']['type']))
												$file = $item['file']['type'];
											$arts[$item['clipart_id']] = array(
												'view'	=> $view,
												'id'	=> $item['clipart_id'],
												'title'	=> $item['title'],
												'thumb'	=> $item['thumb'],
												'file'	=> $file,
												'price'	=> $item['price'],
											);
											if (!in_array($item['clipart_id'].'-'.$qty, $ids))
											{
												$prices = $prices + ($item['price'] * $qty);
												$ids[] 	= $item['clipart_id'].'-'.$qty;
											}
										}
									}
									// update info after paid
									if(isset($_GET['e_order_id']) && isset($_GET['params']) && count($ids) > 0 && $data['design_id'] == $_GET['e_order_id'])
									{
										$e_order_id = $_GET['e_order_id'];
										$params = $_GET['params'];
										$settings = $dg->getSetting();
										$api = $settings->store->api;
										store_art_update($e_order_id, $params, array(), $api);
										//return $html;
										$chk_return = true;
									}
								}
							}
						}
					}
					if(count($arts) && $chk_return == false)
					{
						$settings = $dg->getSetting();
						if(empty($settings->store))
						{
							$msg_store_empty = '<p style="background-color: #fcf8e3;color:#8a6d3b;border: 1px solid #faebcc;padding:14px 12px;margin: 0px;">Your order using arts of <a href="http://store.9file.net/" target="_blank">store</a>. You missing setup API Store. Please go to <strong>T-Shirt eCommerce > Settings > Configuration > Tab Config</strong> setup store to download file output.</p>';
						}
						elseif(empty($settings->store->api) || (isset($settings->store->api) && $settings->store->api == ''))
						{
							$msg_store_empty = '<p style="background-color: #fcf8e3;color:#8a6d3b;border: 1px solid #faebcc;padding:14px 12px;margin: 0px;">Your order using arts of <a href="http://store.9file.net/" target="_blank">store</a>. You missing setup API Store. Please go to <strong>T-Shirt eCommerce > Settings > Configuration > Tab Config</strong> setup store to download file output.</p>';
						}
						else
						{
							$api = $settings->store->api;
							$store_temp['api'] = $api;
							$store_temp['ids'] = $ids;
							$store_temp['ids'] = $ids;
							$store_temp['prices'] = $prices;
							$store_temp['arts'] = $arts;
							$store_temp['qty'] = $qty;
						}
					}
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				'design' => $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']),
				'_design' => isset($design) ? $design : array(),
				'store_temp' => $store_temp,
				'msg_store_empty' => $msg_store_empty,
				'u_return' => $chk_return,
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/account/order_info.tpl">
		<operation error="skip">
			<search position="after"><![CDATA[echo $product['name']]]></search>
			<add><![CDATA[
				<br />
				<?php if( isset($product['design']) && $product['design'] != false && isset($product['design']->rowid))
				{
					$design = $product['design'];

					/* Show link for download design */
					if(isset($design->design_product_id) && !empty($design->design_product_id))
					{
						$_temp_arr = explode(':', $design->design_product_id);
						if(count($_temp_arr) > 1)
						{
							$_key = $_temp_arr[0].':'.$_temp_arr[1].':'.$_temp_arr[2].':'.$design->color_hex;

							echo '<br /><p>';
							echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$_temp_arr[2]. '&parent_id=' . $design->product_id ."&cart_id=".$design->rowid."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";
							
							if(isset($tshirtecommerce_downloadable) && $tshirtecommerce_downloadable == 1 && (!isset($design->images) || empty($design->images)))
							{
								echo ' '.$tshirtecommerce_label_or_download_design.': ';

								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=front'><strong>".$tshirtecommerce_view_front."</strong></a> - ";

								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=back'><strong>".$tshirtecommerce_view_back."</strong></a> - ";

								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=left'><strong>".$tshirtecommerce_view_left."</strong></a> - ";

								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=right'><strong>".$tshirtecommerce_view_right."</strong></a>";
							}
							echo '</p>';
						}
						else
						{
							if(isset($design->images) && !empty($design->images))
							{
								echo '<br /><p>';

								echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$design->design_product_id."&parent_id=".$design->product_id."&cart_id=".$design->rowid."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";

								echo '</p>';
							}
						}
					}

					if(isset($design->color_title))
					{ ?>
						<br /><small><strong>Color:</strong><span title="<?php echo $design->color_title; ?>" style="background-color:#<?php echo $design->color_hex; ?>;display:inline-block;border:1px solid #ccc;width:25px;height:25px;cursor:pointer;outline:1px solid #229BCA;margin-left 4px;"></span></small><br />
					<?php }

					/* options */
					if (isset($design->options) && $design->options != '[]')
					{
						if (is_string($design->options)) $design_options = json_decode( str_replace('&quot;', '"', $design->options) );
						else $design_options = $design->options;
						
						if (is_object($design_options)) $design_options = (array) $design_options;

						$html = '';
						if (count($design_options))
						{
							foreach($design_options as $option)
							{					
								if (isset($option->value))
								{
									if (is_string($option->value) && $option->value != '')
									{
										// Fixed Printing type is empty
										if(empty($option->name) && $option->type == 'printing')
											$option->name = $tshirtecommerce_printing_type; //'Printing type'

										$html .= '<dt>'.$option->name.': '.$option->value.'</dt>';
									}
									else if (count($option->value) > 0)
									{
										$html .= '<dt>'.$option->name.': </dt>';
										$html .=  '<dd>';

										foreach ($option->value as $name => $value)
										{
											if($option->type == 'checkbox')
											{
												$html .= $value. '; ';
											}
											else
											{
												if($value != '0' && $value != 0) $html .= $name.'  -  '.$value. '; ';
											}
										}
										$html .=  '</dd>';
									}
								}
							}
						}
						echo $html;
					}
					/* teams */
					if (isset($design->teams) && isset($design->teams->name) )
					{
						$teams = json_decode( json_encode($design->teams), true );
						$table = '<table class="table table-bordered">'
							. 		'<thead>'
							. 			'<tr>'
							. 				'<th>'.$ts_designer_clipart_edit_name.'</th>'
							. 				'<th>'.$ts_designer_clipart_edit_number.'</th>'
							. 				'<th>'.$tshirtecommerce_head_text_sizes.'</th>'
							. 			'</tr>'
							. 		'</thead>'
							. 		'<tbody>';
						for($i=1; $i<=count($teams['name']); $i++ )
						{
							$size = explode('::', $teams['size'][$i]);
							$table .=	'<tr>'
								.			'<td>'.$teams['name'][$i].'</td>'
								.			'<td>'.$teams['number'][$i].'</td>'
								.			'<td>'.$size[0].'</td>'
								.		'</tr>';
						}
						$table .= '</tbody></table>';
						echo $table;
					}

					/* images */
					if (isset($design->images))
					{
						$images = json_decode(str_replace('&quot;', '"', $design->images), true);
						if (count($images) > 0)
						{								
							$img = '';
							foreach($images as $view => $src)
							{
								$img .= '<div class="img-thumbnail" style="margin:2px;">'											
										.'<a target="_blank" href="'.$base_url.'/tshirtecommerce/'.$src.'" class="pull-left" title="Click to view design"><img style="width:80px;" src="'.$base_url.'/tshirtecommerce/'.$src.'" alt="" title="'.$tshirtecommerce_link_title_edit.'"></a>';

								if(isset($tshirtecommerce_downloadable) && $tshirtecommerce_downloadable == 1 && isset($product['store_temp']) && count($product['store_temp']) == 0)
								{
									$img .= '<br /><center><a target="_blank" href="'.$base_url.'/tshirtecommerce/design.php?key='.$design->rowid.'&view='.$view.'" title="'.$tshirtecommerce_link_title_download.'" alt="'.$tshirtecommerce_link_text_download.'">'.$tshirtecommerce_link_text_download.'</a></center>';
								}
								$img .=	'</div>';
							}
							echo $img;
						}
					}
				} ?>
			]]></add>
		</operation>
	</file>
	<file name="catalog/view/theme/*/template/mail/order.tpl">
		<operation error="skip">
			<search position="after"><![CDATA[echo $option['value']]]></search>
			<add><![CDATA[
				<?php } ?>
				<br />
				<?php if ( isset($product['design']) && $product['design'] != false)
				{ 
					$design = $product['design'];

					/* Show link for download design */
					if(isset($design->design_product_id) && !empty($design->design_product_id))
					{
						$_temp_arr = explode(':', $design->design_product_id);
						if(count($_temp_arr) > 1)
						{
							$_key = $_temp_arr[0].':'.$_temp_arr[1].':'.$_temp_arr[2].':'.$design->color_hex;

							echo '<br /><p>';

							echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$_temp_arr[2]. '&parent_id=' . $design->product_id ."&cart_id=".$design->rowid."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";

							if(isset($tshirtecommerce_downloadable) && $tshirtecommerce_downloadable == 1 && (!isset($design->images) || empty($design->images)))
							{
								echo ' '.$tshirtecommerce_label_or_download_design.': ';

								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='".$base_url."/tshirtecommerce/design.php?idea=1&key=".$_key."&view=front'><strong>".$tshirtecommerce_view_front."</strong></a><span> - </span>";

								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='".$base_url."/tshirtecommerce/design.php?idea=1&key=".$_key."&view=back'><strong>".$tshirtecommerce_view_back."</strong></a><span> - </span>";

								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='".$base_url."/tshirtecommerce/design.php?idea=1&key=".$_key."&view=left'><strong>".$tshirtecommerce_view_left."</strong></a><span> - </span>";

								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='".$base_url."/tshirtecommerce/design.php?idea=1&key=".$_key."&view=right'><strong>".$tshirtecommerce_view_right."</strong></a>";
							}
							echo '</p>';
						}
						else
						{
							if(isset($design->images) && !empty($design->images))
							{
								echo '<br /><p>';

								echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$design->design_product_id."&parent_id=".$design->product_id."&cart_id=".$design->rowid."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";

								echo '</p>';
							}
						}
					}
					if(isset($design->color_title))
					{ ?>
						<p style='height:25px;width:auto'><strong>Color:</strong></p>
						<p title='<?php echo $design->color_title; ?>' style='background-color:#<?php echo $design->color_hex ?>; height:25px; width:25px;border: 1px solid #cdcdcd;outline: 1px solid #229BCA;margin: 2px;'></p>
						<br />
					<?php }

					/* options */
					if (isset($design->options) && $design->options != '[]')
					{
						if (is_string($design->options))
							$design_options = json_decode( str_replace('&quot;', '"', $design->options) );
						else
							$design_options = $design->options;

						$html = '';
						if (count($design_options))
						{
							foreach($design_options as $option)
							{					
								if (isset($option->value))
								{
									if (is_string($option->value) && $option->value != '')
									{
										// Fixed Printing type is empty
										if(empty($option->name) && $option->type == 'printing')
											$option->name = $tshirtecommerce_printing_type; //'Printing type'

										$html .= '<p><strong>'.$option->name.': '.$option->value.'</strong></p>';
									}
									else if (count($option->value) > 0)
									{
										$html .= '<p><strong>'.$option->name.':</strong> </p>';

										foreach ($option->value as $name => $value)
										{
											if($value != '0' && $value != 0) $html .=  $name.'  -  '.$value. '; ';
										}
									}
								}
							}
						}
						echo $html;
					}
					/* teams */
					if (isset($design->teams) && isset($design->teams->name) )
					{
						$teams = json_decode( json_encode($design->teams), true );
						$table = '<table class="table table-bordered">'
							. 		'<thead>'
							. 			'<tr>'
							. 				'<th>'.$ts_designer_clipart_edit_name.'</th>'
							. 				'<th>'.$ts_designer_clipart_edit_number.'</th>'
							. 				'<th>'.$tshirtecommerce_head_text_sizes.'</th>'
							. 			'</tr>'
							. 		'</thead>'
							. 		'<tbody>';
						for($i=1; $i<=count($teams['name']); $i++ )
						{
							$size = explode('::', $teams['size'][$i]);
							$table .=	'<tr>'
								.			'<td>'.$teams['name'][$i].'</td>'
								.			'<td>'.$teams['number'][$i].'</td>'
								.			'<td>'.$size[0].'</td>'
								.		'</tr>';
						}
						$table .= '</tbody></table>';
						echo $table;
					}

					/* images */
					if (isset($design->images))
					{
						$images = json_decode(str_replace('&quot;', '"', $design->images), true);
						if (count($images) > 0)
						{								
							$img = '';
							foreach($images as $view => $src)
							{
								$img .= '<center style="float:left;background-color: #fff;margin:2px;border: 1px solid #ddd;border-radius: 4px;display: inline-block;line-height: 1.42857;transition: all 0.2s ease-in-out 0s;padding: 4px;">';

								$img .= '<a target="_blank" href="'.$base_url.'/tshirtecommerce/'.$src.'" title="">';

								$img .= '<img style="width:70px;height:auto" src="'.$base_url.'/tshirtecommerce/'.$src.'" alt="" width="70px" />';

								if(isset($tshirtecommerce_downloadable) && $tshirtecommerce_downloadable == 1 && isset($product['store_temp']) && count($product['store_temp']) == 0)
								{
									$img .= '<br /><a href="'.$base_url.'/tshirtecommerce/design.php?key='.$design->rowid.'&view='.$view.'" target="_blank" title="'.$tshirtecommerce_link_title_download.'">'.$tshirtecommerce_link_text_download.'</a>';
								}

								$img .= '</a>';
								$img .= '</center>';
							}
							echo $img;
						}
					} ?>
			]]></add>
		</operation>
	</file>
</modification>